# SPDX-FileCopyrightText: Copyright (c) 2025-2026, NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Example configuration for nvidia-nat-vanna package

general:
  use_uvloop: true
  telemetry:
    logging:
      console:
        _type: console
        level: INFO

functions:
  # Text-to-SQL function using Vanna
  text2sql:
    _type: text2sql
    llm_name: nim_llm
    embedder_name: nim_embedder
    milvus_retriever: milvus_retriever  # Uses connection info from retriever config

    # Database configuration
    database_type: databricks
    connection_url: "${CONNECTION_URL}"  # Database connection string

    # Vanna settings
    allow_llm_to_see_data: false
    execute_sql: false
    train_on_startup: false
    n_results: 5 # number of similar SQL examples to retrieve
    sql_collection: "vannasql_vtest_10"
    ddl_collection: "vannaddl_vtest_10"
    doc_collection: "vannadoc_vtest_10"
    milvus_search_limit: 1000  # Maximum records to retrieve from Milvus

  # Database query execution function
  execute_db_query:
    _type: execute_db_query
    database_type: databricks
    connection_url: "${CONNECTION_URL}"  # Database connection string
    max_rows: 100

# LLM configuration
llms:
  nim_llm:
    _type: nim
    model_name: meta/llama-3.1-70b-instruct
    api_key: "${NVIDIA_API_KEY}"
    base_url: https://integrate.api.nvidia.com/v1
    temperature: 0.0
    max_tokens: 2000

  oai_oss_120b:
    _type: openai
    model_name: openai/gpt-oss-120b
    base_url: https://integrate.api.nvidia.com/v1
    api_key: ${NVIDIA_API_KEY}
    temperature: 1
    top_p: 1
    max_tokens: 4096

  oai_oss_20b:
    _type: openai
    model_name: openai/gpt-oss-20b
    base_url: https://integrate.api.nvidia.com/v1
    api_key: ${NVIDIA_API_KEY}
    temperature: 1
    top_p: 1
    max_tokens: 4096

  nemotron_253b:
    _type: nim
    model_name: nvidia/llama-3.1-nemotron-ultra-253b-v1
    base_url: https://integrate.api.nvidia.com/v1
    api_key: ${NVIDIA_API_KEY}
    temperature: 0.0
    max_tokens: 4096

  nemotron_49b_1_5:
    _type: nim
    model_name: nvidia/llama-3.3-nemotron-super-49b-v1.5
    base_url: https://integrate.api.nvidia.com/v1
    api_key: ${NVIDIA_API_KEY}
    temperature: 0.0
    max_tokens: 4096

  ds_v31:
    _type: openai
    model_name: deepseek-ai/deepseek-v3.1
    base_url: https://integrate.api.nvidia.com/v1
    api_key: ${NVIDIA_API_KEY}
    temperature: 0
    max_tokens: 4096

# Embedder configuration
embedders:
  nim_embedder:
    _type: nim
    model_name: nvidia/llama-3.2-nv-embedqa-1b-v2
    api_key: "${NVIDIA_API_KEY}"
    base_url: https://integrate.api.nvidia.com/v1

retrievers:
  milvus_retriever:
    _type: milvus_retriever
    uri: "${MILVUS_URI}"
    connection_args:
      user: "developer"
      password: "${MILVUS_PASSWORD}"
      db_name: "default"
    embedding_model: nim_embedder
    content_field: text
    use_async_client: true

workflow:
  _type: rewoo_agent
  tool_names:
    - text2sql
    - execute_db_query
  llm_name: nim_llm
  verbose: true
  max_history: 10
  tool_call_max_retries: 3
