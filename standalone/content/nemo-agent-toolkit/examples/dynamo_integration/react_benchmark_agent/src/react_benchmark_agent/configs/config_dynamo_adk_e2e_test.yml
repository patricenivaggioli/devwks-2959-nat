# SPDX-FileCopyrightText: Copyright (c) 2025-2026, NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# <!-- path-check-skip-file -->

# =============================================================================
# DYNAMO + GOOGLE ADK INTEGRATION TEST
# =============================================================================
# Purpose: Tests the Dynamo LLM provider with Google ADK framework
# 
# This configuration demonstrates:
# - Using the Dynamo LLM provider (_type: dynamo) with Google ADK
# - Automatic prefix header injection via LiteLLM's extra_headers
# - KV cache optimization through consistent prefix IDs per client
#
# Key Differences from LangChain:
# - ADK uses LiteLLM under the hood, not httpx directly
# - Headers are passed via extra_headers at initialization time
# - All requests from the same client share the same prefix ID (ideal for conversations)
#
# Usage:
#   # Install ADK demo package first (if not installed)
#   pip install -e './examples/frameworks/adk_demo'
#
#   # Run the test
#   nat run --config_file examples/dynamo_integration/react_benchmark_agent/configs/config_dynamo_adk_e2e_test.yml \
#       --input "What time is it in New York?"
#
# Expected Output:
#   - LLM calls should include Dynamo prefix headers (visible in server logs)
#   - All tool calls within the conversation share the same prefix ID
# =============================================================================

functions:
  # Simple datetime tool for testing (optional - can be removed for basic I/O tests)
  current_datetime:
    _type: current_datetime

llms:
  dynamo_llm:
    _type: dynamo
    # LiteLLM requires provider prefix for custom endpoints
    # Use "openai:model-name" format for OpenAI-compatible APIs
    model_name: "openai/llama-3.3-70b"
    base_url: http://localhost:8099/v1
    api_key: dummy  # Dynamo doesn't require auth, but LiteLLM needs a value
    temperature: 0.0
    max_tokens: 1024
    
    # ===== DYNAMO PREFIX CONFIGURATION FOR ADK =====
    # These headers are passed to LiteLLM via extra_headers
    # All requests from this LLM instance will share the same prefix ID
    prefix_template: "adk-dynamo-test-{uuid}"
    prefix_total_requests: 5  # Expected tool calls per conversation
    prefix_osl: MEDIUM        # Output Sequence Length hint
    prefix_iat: MEDIUM        # Inter-Arrival Time hint
    # ================================================

workflow:
  _type: adk
  name: dynamo_adk_test_agent
  llm: dynamo_llm
  # NOTE: tool_names removed for basic I/O testing
  # Add tool_names: [current_datetime] if you need tool calling (requires function-calling capable endpoint)
  tool_names: []
  description: "A test agent for validating Dynamo + ADK integration"
  prompt: |
    You are a helpful assistant. Provide clear and concise answers.

